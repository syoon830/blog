[{"_path":"/posts/38527f39-69f6-4663-ba58-351831ed48b4","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"nuxt3 $fetch","description":"nuxt3에서는 $fetch는 ofetch라는 라이브러리를 사용하고 있다. (ofetch는 node, browser 환경 두군데서 같이 사용할 수 있다.)","tags":["nuxt","axios"],"date":"2024-01-22T00:00:00.000Z","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"nuxt3에서는 $fetch는 ofetch라는 라이브러리를 사용하고 있다. (ofetch는 node, browser 환경 두군데서 같이 사용할 수 있다.)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"그래서 기존 axios로 설정된 코드들을 뜯어 고쳤다."}]},{"type":"element","tag":"pre","props":{"className":["language-javascript"],"code":"// 기존\nimport axios from 'axios';\nimport type { AxiosInstance } from 'axios';\nimport {useAuthStore} from \"~/store/auth\";\n\nexport default defineNuxtPlugin(nuxtApp => {\n    const config = useRuntimeConfig().public;\n    const clientId = config.clientId;\n    const clientServer = config.clientServer;\n    const btoaClientInfo = btoa(`${clientId}:${clientServer}`);\n\n    const authStore = useAuthStore();\n    const axiosInstance: AxiosInstance = axios.create({\n        baseURL: config.BASE_URL,\n    });\n\n    axiosInstance.interceptors.request.use((config) => {\n        if (authStore.isAuthenticated) {\n            config.headers.Authorization = `Bearer ${authStore.token}`;\n        } else {\n            config.headers.Authorization = `Basic ${btoaClientInfo}`;\n        }\n        return config;\n    });\n\n    nuxtApp.provide('axios', axiosInstance);\n});\n\n// 수정\nimport { useAuthStore } from \"~/store/auth\";\n\nexport default defineNuxtPlugin(nuxtApp => {\n    const config = useRuntimeConfig().public;\n    const clientId = config.clientId;\n    const clientServer = config.clientServer;\n    const btoaClientInfo = btoa(`${clientId}:${clientServer}`);\n\n    const apiFetch = $fetch.create({\n        baseURL: config.BASE_URL,\n        onRequest({ options }) {\n            const authStore = useAuthStore();\n            if (authStore.isAuthenticated) {\n                options.headers = {\n                    Authorization: `Bearer ${authStore.token}`\n                };\n            } else {\n                options.headers = {\n                    Authorization: `Basic ${btoaClientInfo}`\n                };\n            }\n        }\n    })\n    \n    nuxtApp.provide('apiFetch', apiFetch);\n});\n","language":"javascript","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// 기존\nimport axios from 'axios';\nimport type { AxiosInstance } from 'axios';\nimport {useAuthStore} from \"~/store/auth\";\n\nexport default defineNuxtPlugin(nuxtApp => {\n    const config = useRuntimeConfig().public;\n    const clientId = config.clientId;\n    const clientServer = config.clientServer;\n    const btoaClientInfo = btoa(`${clientId}:${clientServer}`);\n\n    const authStore = useAuthStore();\n    const axiosInstance: AxiosInstance = axios.create({\n        baseURL: config.BASE_URL,\n    });\n\n    axiosInstance.interceptors.request.use((config) => {\n        if (authStore.isAuthenticated) {\n            config.headers.Authorization = `Bearer ${authStore.token}`;\n        } else {\n            config.headers.Authorization = `Basic ${btoaClientInfo}`;\n        }\n        return config;\n    });\n\n    nuxtApp.provide('axios', axiosInstance);\n});\n\n// 수정\nimport { useAuthStore } from \"~/store/auth\";\n\nexport default defineNuxtPlugin(nuxtApp => {\n    const config = useRuntimeConfig().public;\n    const clientId = config.clientId;\n    const clientServer = config.clientServer;\n    const btoaClientInfo = btoa(`${clientId}:${clientServer}`);\n\n    const apiFetch = $fetch.create({\n        baseURL: config.BASE_URL,\n        onRequest({ options }) {\n            const authStore = useAuthStore();\n            if (authStore.isAuthenticated) {\n                options.headers = {\n                    Authorization: `Bearer ${authStore.token}`\n                };\n            } else {\n                options.headers = {\n                    Authorization: `Basic ${btoaClientInfo}`\n                };\n            }\n        }\n    })\n    \n    nuxtApp.provide('apiFetch', apiFetch);\n});\n"}]}]},{"type":"element","tag":"h2","props":{"id":"참고"},"children":[{"type":"text","value":"참고"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://jongmin4943.tistory.com/entry/Nuxt3-fetch-useAsyncData-useFetch-%EC%9D%98-%EC%B0%A8%EC%9D%B4","rel":["nofollow"]},"children":[{"type":"text","value":"https://jongmin4943.tistory.com/entry/Nuxt3-fetch-useAsyncData-useFetch-의-차이"}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"참고","depth":2,"text":"참고"}]}},"_type":"markdown","_id":"content:posts:38527f39-69f6-4663-ba58-351831ed48b4.md","_source":"content","_file":"posts/38527f39-69f6-4663-ba58-351831ed48b4.md","_extension":"md"},{"_path":"/posts/e9a8a610-ff29-4403-bbb0-55a5438aad7c","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"formData 전송 방법","description":"axios를 $fetch로 변경하면서 로그인시 문제가 발생하였다.","tags":["axios","$fetch"],"date":"2024-01-18T00:00:00.000Z","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"axios를 $fetch로 변경하면서 로그인시 문제가 발생하였다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"기존에 axios를 사용할때는 아래와 같이 사용중이고"}]},{"type":"element","tag":"pre","props":{"className":["language-javascript"],"code":"await axios.post(url, qs.stringfy(payload));\n","language":"javascript","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"await axios.post(url, qs.stringfy(payload));\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"전달된 형태를 보니 Form Data로 전송이 되고 있다."}]},{"type":"element","tag":"img","props":{"src":"https://prod-files-secure.s3.us-west-2.amazonaws.com/122c4317-821b-493a-85a2-3b119a538ecc/9dafbaca-364e-44e5-a781-a09ea600235f/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240122%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240122T081102Z&X-Amz-Expires=3600&X-Amz-Signature=55e60c1d56581e762fddc03051f2695acb9cc1c3de637c1c69d4367317a53867&X-Amz-SignedHeaders=host&x-id=GetObject"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"$fetch는 아래와 같이 사용을 했는데"}]},{"type":"element","tag":"pre","props":{"className":["language-javascript"],"code":"await apiFetch(url, {\n    method: 'POST',\n    body: qs.stringfy(payload)\n});\n","language":"javascript","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"await apiFetch(url, {\n    method: 'POST',\n    body: qs.stringfy(payload)\n});\n"}]}]},{"type":"element","tag":"img","props":{"src":"https://prod-files-secure.s3.us-west-2.amazonaws.com/122c4317-821b-493a-85a2-3b119a538ecc/4668e01f-3943-43c8-a597-0451918ee3ed/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240122%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240122T081102Z&X-Amz-Expires=3600&X-Amz-Signature=9e5849419f7e44fbb23a4e1cc2243df7de5345a18ac7d7a68473055edf85e31c&X-Amz-SignedHeaders=host&x-id=GetObject"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"이렇게 전달이 돼서 로그인이 안되는것이다."}]},{"type":"element","tag":"h2","props":{"id":"_2가지-해결법"},"children":[{"type":"text","value":"2가지 해결법"}]},{"type":"element","tag":"h3","props":{"id":"_1-header에-content-type-applicationx-www-form-urlencoded-넣어주기"},"children":[{"type":"text","value":"1. header에 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"'Content-Type': 'application/x-www-form-urlencoded'"}]},{"type":"text","value":"  넣어주기"}]},{"type":"element","tag":"pre","props":{"className":["language-javascript"],"code":"$fetch(url, {\n    method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        },\n    body: qs.stringfy(payload)\n})\n","language":"javascript","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$fetch(url, {\n    method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        },\n    body: qs.stringfy(payload)\n})\n"}]}]},{"type":"element","tag":"h3","props":{"id":"_2-new-urlsearchparams-사용"},"children":[{"type":"text","value":"2. "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"new URLSearchParams"}]},{"type":"text","value":" 사용"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"원래는 new FormData 만들어서 일일히 append 해줘야하는데 위 함수로 간편하게 만들어준다."}]},{"type":"element","tag":"pre","props":{"className":["language-javascript"],"code":"$fetch(url, {\n    method: 'POST',\n    body: new URLSearchParams(qs.stringfy(payload))\n});\n","language":"javascript","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$fetch(url, {\n    method: 'POST',\n    body: new URLSearchParams(qs.stringfy(payload))\n});\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"나는 그냥 1번으로 사용하였다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Axios를 사용할 때 별도의 설정이 없으면, "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"qs.stringify"}]},{"type":"text","value":"를 사용하여 변환된 데이터는 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"application/x-www-form-urlencoded"}]},{"type":"text","value":" 형식으로 전송된다."}]}]},{"type":"element","tag":"h3","props":{"id":"참고"},"children":[{"type":"text","value":"참고"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://inpa.tistory.com/entry/JS-%F0%9F%93%9A-FormData-%EC%A0%95%EB%A6%AC-fetch-api","rel":["nofollow"]},"children":[{"type":"text","value":"https://inpa.tistory.com/entry/JS-📚-FormData-정리-fetch-api"}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"_2가지-해결법","depth":2,"text":"2가지 해결법","children":[{"id":"_1-header에-content-type-applicationx-www-form-urlencoded-넣어주기","depth":3,"text":"1. header에 'Content-Type': 'application/x-www-form-urlencoded'  넣어주기"},{"id":"_2-new-urlsearchparams-사용","depth":3,"text":"2. new URLSearchParams 사용"},{"id":"참고","depth":3,"text":"참고"}]}]}},"_type":"markdown","_id":"content:posts:e9a8a610-ff29-4403-bbb0-55a5438aad7c.md","_source":"content","_file":"posts/e9a8a610-ff29-4403-bbb0-55a5438aad7c.md","_extension":"md"}]