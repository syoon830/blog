[{"_path":"/posts/38527f39-69f6-4663-ba58-351831ed48b4","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"nuxt3 $fetch","description":"nuxt3에서는 $fetch는 ofetch라는 라이브러리를 사용하고 있다. (ofetch는 node, browser 환경 두군데서 같이 사용할 수 있다.)","tags":["nuxt","axios"],"date":"2024-01-22T00:00:00.000Z","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"nuxt3에서는 $fetch는 ofetch라는 라이브러리를 사용하고 있다. (ofetch는 node, browser 환경 두군데서 같이 사용할 수 있다.)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"그래서 기존 axios로 설정된 코드들을 뜯어 고쳤다."}]},{"type":"element","tag":"pre","props":{"className":["language-javascript"],"code":"// 기존\nimport axios from 'axios';\nimport type { AxiosInstance } from 'axios';\nimport {useAuthStore} from \"~/store/auth\";\n\nexport default defineNuxtPlugin(nuxtApp => {\n    const config = useRuntimeConfig().public;\n    const clientId = config.clientId;\n    const clientServer = config.clientServer;\n    const btoaClientInfo = btoa(`${clientId}:${clientServer}`);\n\n    const authStore = useAuthStore();\n    const axiosInstance: AxiosInstance = axios.create({\n        baseURL: config.BASE_URL,\n    });\n\n    axiosInstance.interceptors.request.use((config) => {\n        if (authStore.isAuthenticated) {\n            config.headers.Authorization = `Bearer ${authStore.token}`;\n        } else {\n            config.headers.Authorization = `Basic ${btoaClientInfo}`;\n        }\n        return config;\n    });\n\n    nuxtApp.provide('axios', axiosInstance);\n});\n\n// 수정\nimport { useAuthStore } from \"~/store/auth\";\n\nexport default defineNuxtPlugin(nuxtApp => {\n    const config = useRuntimeConfig().public;\n    const clientId = config.clientId;\n    const clientServer = config.clientServer;\n    const btoaClientInfo = btoa(`${clientId}:${clientServer}`);\n\n    const apiFetch = $fetch.create({\n        baseURL: config.BASE_URL,\n        onRequest({ options }) {\n            const authStore = useAuthStore();\n            if (authStore.isAuthenticated) {\n                options.headers = {\n                    Authorization: `Bearer ${authStore.token}`\n                };\n            } else {\n                options.headers = {\n                    Authorization: `Basic ${btoaClientInfo}`\n                };\n            }\n        }\n    })\n    \n    nuxtApp.provide('apiFetch', apiFetch);\n});\n","language":"javascript","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// 기존\nimport axios from 'axios';\nimport type { AxiosInstance } from 'axios';\nimport {useAuthStore} from \"~/store/auth\";\n\nexport default defineNuxtPlugin(nuxtApp => {\n    const config = useRuntimeConfig().public;\n    const clientId = config.clientId;\n    const clientServer = config.clientServer;\n    const btoaClientInfo = btoa(`${clientId}:${clientServer}`);\n\n    const authStore = useAuthStore();\n    const axiosInstance: AxiosInstance = axios.create({\n        baseURL: config.BASE_URL,\n    });\n\n    axiosInstance.interceptors.request.use((config) => {\n        if (authStore.isAuthenticated) {\n            config.headers.Authorization = `Bearer ${authStore.token}`;\n        } else {\n            config.headers.Authorization = `Basic ${btoaClientInfo}`;\n        }\n        return config;\n    });\n\n    nuxtApp.provide('axios', axiosInstance);\n});\n\n// 수정\nimport { useAuthStore } from \"~/store/auth\";\n\nexport default defineNuxtPlugin(nuxtApp => {\n    const config = useRuntimeConfig().public;\n    const clientId = config.clientId;\n    const clientServer = config.clientServer;\n    const btoaClientInfo = btoa(`${clientId}:${clientServer}`);\n\n    const apiFetch = $fetch.create({\n        baseURL: config.BASE_URL,\n        onRequest({ options }) {\n            const authStore = useAuthStore();\n            if (authStore.isAuthenticated) {\n                options.headers = {\n                    Authorization: `Bearer ${authStore.token}`\n                };\n            } else {\n                options.headers = {\n                    Authorization: `Basic ${btoaClientInfo}`\n                };\n            }\n        }\n    })\n    \n    nuxtApp.provide('apiFetch', apiFetch);\n});\n"}]}]},{"type":"element","tag":"h2","props":{"id":"참고"},"children":[{"type":"text","value":"참고"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://jongmin4943.tistory.com/entry/Nuxt3-fetch-useAsyncData-useFetch-%EC%9D%98-%EC%B0%A8%EC%9D%B4","rel":["nofollow"]},"children":[{"type":"text","value":"https://jongmin4943.tistory.com/entry/Nuxt3-fetch-useAsyncData-useFetch-의-차이"}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"참고","depth":2,"text":"참고"}]}},"_type":"markdown","_id":"content:posts:38527f39-69f6-4663-ba58-351831ed48b4.md","_source":"content","_file":"posts/38527f39-69f6-4663-ba58-351831ed48b4.md","_extension":"md"},{"_path":"/posts/9ecb10c2-fa24-449c-ac39-8553ee942084","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"nuxt에서 localstorage 이슈","description":"기존에 cookie에 auth 정보를 저장했을때는 미들웨어가 잘 동작을 했는데, 테스트상 localstorage에 저장을 해보니 미들웨어가 제대로 동작을 안한다.","tags":["nuxt","ssr","middleware"],"date":"2024-01-16T00:00:00.000Z","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"기존에 cookie에 auth 정보를 저장했을때는 미들웨어가 잘 동작을 했는데, 테스트상 localstorage에 저장을 해보니 미들웨어가 제대로 동작을 안한다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"pre","props":{"className":["language-javascript"],"code":"import { useAuthStore } from \"~/store/auth\";\n\nexport default defineNuxtRouteMiddleware((to, from) => {\n\n    const authStore = useAuthStore();\n    const nonAuthPages = ['index', 'login'];\n    if (authStore.isAuthenticated) {\n        if (nonAuthPages.includes(to.name)) {\n            return navigateTo('/dashboard');\n        }\n    } else {\n        if (!nonAuthPages.includes(to.name)) {\n            return navigateTo('/login');\n        }\n    }\n}\n","language":"javascript","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import { useAuthStore } from \"~/store/auth\";\n\nexport default defineNuxtRouteMiddleware((to, from) => {\n\n    const authStore = useAuthStore();\n    const nonAuthPages = ['index', 'login'];\n    if (authStore.isAuthenticated) {\n        if (nonAuthPages.includes(to.name)) {\n            return navigateTo('/dashboard');\n        }\n    } else {\n        if (!nonAuthPages.includes(to.name)) {\n            return navigateTo('/login');\n        }\n    }\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"위 코드를 보면 로그인하면 index, login 페이지 접근 못하게, 로그인 안하면 index, login을 제외한 나머지 페이지 접근 못하게 코드를 짰다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"로그인한 상태에서는 organization으로 접근을 해야하는데 login 페이지를 거쳐서 dashboard로 이동을 한다."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"원인을 살펴보니 ssr에서 localStorage에 접근을 못하여 예상하지 못한 로직으로 흐름이 발생한거였다. (server-side에서는 cookie에만 접근이 가능하다.)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"h2","props":{"id":"localstorage에-auth정보-저장-시-흐름-isauthenticated는-true"},"children":[{"type":"text","value":"localStorage에 auth정보 저장 시 흐름 (isAuthenticated는 true)"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"organization 페이지에 접근\n"},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"server-side에서 middleware 동작\n"},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"이때 server-side에서는 localstorage에 접근을 못하니까 authStore 정보를 못 얻어온다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"navigateTo(’/login’)이 실행된다."}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"login 페이지 접근\n"},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"server-side에서 middleware가 동작\n"},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"마찬가지로 server-side에서는 localstorage에 접근을 못하니까 authStore 정보를 못 얻어온다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"navigateTo(’/login’)이 실행된다."}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"같은 페이지로 리다이렉트 됐기 때문에 더이상 ssr은 실행되지 않고 csr이 실행된다."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"login 화면이 렌더링\n"},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"client-side에서 middleware 동작\n"},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"csr에서는 localstorage에 접근이 가능하기 때문에 authStore 정보를 얻어옴"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"nonAuthPages에 포함됨"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"navigateTo(’dashboard’)이 실행된다."}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dashboard 화면이 렌더링 (client-side에서 middleware 동작은 생략)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"SSR 환경에서의 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"navigateTo"}]},{"type":"text","value":"는 먼저 서버 측에서 처리되고 그 후 클라이언트 측에서 렌더링된다."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n반면, CSR 환경에서의 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"navigateTo"}]},{"type":"text","value":"는 클라이언트 측에서만 처리되며, 서버 측 처리는 발생하지 않는다."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"img","props":{"src":"/images/aab46005-3292-4132-aaf2-b4cb265ebffd.png"},"children":[]},{"type":"element","tag":"hr","props":{},"children":[]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"localstorage에-auth정보-저장-시-흐름-isauthenticated는-true","depth":2,"text":"localStorage에 auth정보 저장 시 흐름 (isAuthenticated는 true)"}]}},"_type":"markdown","_id":"content:posts:9ecb10c2-fa24-449c-ac39-8553ee942084.md","_source":"content","_file":"posts/9ecb10c2-fa24-449c-ac39-8553ee942084.md","_extension":"md"},{"_path":"/posts/ef65e77b-7018-4854-8ba1-e14fc2a8fba9","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Property \"query\" was accessed during render but is not defined on instance","description":"","tags":["nuxt"],"date":"2024-01-05T00:00:00.000Z","body":{"type":"root","children":[{"type":"element","tag":"pre","props":{"className":["language-css"],"code":"// AS-IS\nconst { query } = defineProps();\n\n// TO-BE\nconst { query } = defineProps(['query']);\n\n","language":"css","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// AS-IS\nconst { query } = defineProps();\n\n// TO-BE\nconst { query } = defineProps(['query']);\n\n"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:ef65e77b-7018-4854-8ba1-e14fc2a8fba9.md","_source":"content","_file":"posts/ef65e77b-7018-4854-8ba1-e14fc2a8fba9.md","_extension":"md"},{"_path":"/posts/d35aaedb-0f64-4f7f-8c76-97e2069cbadd","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"nuxt3 정적 사이트 github page에서 js파일들 404에러 날때","description":"githubpage에 generage해서 올렸는데 자꾸 에러가 나는거다… 이유를 몰라서 밤새 검색했는데도 답이 안나오고","tags":["nuxt"],"date":"2024-01-03T00:00:00.000Z","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"githubpage에 generage해서 올렸는데 자꾸 에러가 나는거다… 이유를 몰라서 밤새 검색했는데도 답이 안나오고"}]},{"type":"element","tag":"img","props":{"src":"/images/7c60ea47-de9f-48d5-93f3-fa216d63903a.png"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"결국 nuxt github issue에서 찾았다 ㅠㅠ"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/nuxt/nuxt/issues/10113","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/nuxt/nuxt/issues/10113"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":".nojeklly"}]},{"type":"element","tag":"pre","props":{"className":["language-json"],"code":"\"deploy\": \"nuxt generate && touch .output/public/.nojekyll && gh-pages --dotfiles -d .output/public”\n","language":"json","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"\"deploy\": \"nuxt generate && touch .output/public/.nojekyll && gh-pages --dotfiles -d .output/public”\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"결론은 generate하고 프로젝트 폴더안에 .nojekyll 파일이 있어야 되는거였다. (github page는 기본적으로 jekyll이라는 정적 사이트 생성기를 사용함)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":".nojekyll 파일이 있으면 github 페이지는 jekyll 처리를 건너뜀."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"오늘의 개발 교훈: github issue를 잘 찾아보자!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\\n"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:d35aaedb-0f64-4f7f-8c76-97e2069cbadd.md","_source":"content","_file":"posts/d35aaedb-0f64-4f7f-8c76-97e2069cbadd.md","_extension":"md"}]